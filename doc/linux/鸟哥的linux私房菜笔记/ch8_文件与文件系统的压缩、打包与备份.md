# 第八章, 文件与文件系统的压缩, 打包与备份
## 压缩文件的用途和技术
-   压缩文件的技术  
    将一个Byte中添0的地方丢出去, 或是重复的数据进行统计记录
## linux系统常见的压缩指令
-   一些常用的压缩文件的拓展名
    -   .Z      compress程序压缩的文件
    -   .zip    zip程序压缩的文件
    -   .gz     gzip程序压缩的文件
    -   .bz2    bzip2程序压缩的文件
    -   .xz     xz程序压缩的文件
    -   .tar    tar程序打包的文件, 并没有压缩过
    -   .tar.gz     tar程序打包的文件, 经过gzip的压缩
    -   .tar.bz2    tar程序打包的文件, 并且经过bzip2的压缩
    -   .tar.xz     tar程序打包的文件, 并且经过xz的压缩
-   基本压缩指令
    -   gzip    应用最广的压缩指令, 可以解开compress, zip, gzip等压缩的文件
      ```shell
        gzip [-cdtv#] 文件名
        zcat 文件名.gz      //查询压缩文件的内容
        egrep               //相当于grep
        选项和参数:
        -c: 将压缩的数据输出到屏幕上, 可通过数据流重导向来处理
        -d: 解压缩的参数
        -t: 可以用来检验一个压缩文件的一致性, 看文件有无错误
        -v: 可以显示出原文件/压缩文件的压缩比等信息
        -#: #是数字的意思, 表示压缩等级, -1最快, 但是压缩比最差, -9反之, 默认是-6      
      ```
        ###waring:文件被压缩之后, 原始文件就不存在了###
    -   bzip2   提供最佳的压缩比
      ```shell
        bzip2 [-cdkzv#] 文件名
        bzcat 文件名.bz2    查看压缩文件的内容
        选项和参数:
        -c: 将压缩的数据输出到屏幕上, 可通过数据流重导向来处理
        -d: 解压缩的参数
        -v: 可以显示出原文件/压缩文件的压缩比等信息
        -#: #是数字的意思, 表示压缩等级, -1最快, 但是压缩比最差, -9反之, 默认是-6
        -k: 保留源文件
        -z: 压缩的参数      
      ```

    -   xz      压缩比更高
      ```shell
        xz [-dtlkc#] 文件名
        xcat 文件名.xz      查看压缩文件内容
        选项和参数:
        -c: 将压缩的数据输出到屏幕上, 可通过数据流重导向来处理
        -d: 解压缩的参数
        -#: #是数字的意思, 表示压缩等级, -1最快, 但是压缩比最差, -9反之, 默认是-6
        -k: 保留源文件
        -t: 可以用来检验一个压缩文件的一致性, 看文件有无错误      
      ```

-   打包指令
    -   tar
      ```shell
        tar [-z&#124;-J] [cv] [-f 待创建的新文件名] filename...  打包
        tar [-z&#124;-J] [tv] [-f 既有的tar文件名] filename...  查看
        tar [-z&#124;-J] [xv] [-f 既有的tar文件名] [-C 目录] filename...  解压
        选项和参数:
        -c: 创建打包文件, 可以搭配-v来查看过程中被打包的文件名
        -t: 查看打包文件的内容含有哪些文件名, 重点在查看'文件名'
        -x: 解压缩, 可以搭配-C在特定目录解开, -c -t -x不可以同时出现在一条命令中
        -z: 通过gzip支持压缩/解压缩
        -j: 通过bzip2的支持进行压缩/解压缩
        -J: 通过xz的支持进行压缩/解压缩
        waring:zjJ不能同时出现在一串命令行中
        -v: 在压缩/解压缩过程中把正在处理的文件名答应出来
        -f filename: -f后加立即接要被处理的文件名
        -C 目录: 在特定目录解压缩
        -p: 保留备份数据的原本权限和属性
        -P: 保留绝对路径, 也就是允许备份数据中含有根目录存在
        --exclude=FILE: 在压缩过程中, 不要把FILE打包      
      ```

        最简单常用的tar
        ```shell
        压缩: tar -jcv -f filename.tar.bz2 要被压缩的文件或目录名
        查询: tar -jtv -f filename.tar.bz2
        解压缩: tar -jxv -f filename.tar.bz2 -C        
        ```

## 文件系统的备份和还原
### XFS文件系统备份xfsdump
第一次进行完整备份, 之后每次只备份有所改变的那部分  
有以下限制:
-   不支持没有挂载的文件系统备份
-   必须用root操作
-   只能备份XFS文件系统
-   备份下来的数据只能xfsrestore解析
-   通过文件系统的UUID来分辨备份文件的, 所以不能备份两个具有相同UUID的文件系统

```
xfsdump [-L S_label] [-M M_label] [-l #] [-f 备份文件] 待备份数据
选项和参数
-L: xfsdump会记录每次备份的session标头, 这里可以填写针对此文件系统的简单说明
-M: xfsdump可以记录储存媒体的标头, 这里可以填写此媒体的简易说明
-l: 指定等级, 有0-9十个等级, 默认0是完整备份
-f: 后面接产生备份文件的filename
-I: 从/var/lib/xfsdump/inventory列出目前备份的信息状态
```

***xfsdump只能备份文件系统***
### XFS文件系统还原xfsrestore
```shell
xfsrestore -I   用来查看备份文件数据
xfsrestore [-f 备份文件] [-L S_label] [-s] 修复原目录, 单一文件全系统复原
xfsrestore [-f 备份文件] -r 待复原目录  通过累积备份文件来复原系统
xfsrestore [-f 备份文件] -i 待复原目录  进入交互模式
选项和参数
-I: 跟xfsdump相同, 查询相关信息
-f: 后面接的就是备份文件
-L: 就是session的Label name
-s: 需要接特定目录, 只复原某一文件或目录
-r: 如果是用文件来储存备份数据的话, 就不需要使用
-i: 进入交互模式
```
## 光盘写入文件

## 其他常见的压缩与备份工具
-   dd      读取磁盘设备的内容, 然后将整个设备备份成一个文件
  ```shell
    dd if="input_file" of="output_file" bs="block_size" count="number"
    选项和参数
    if: input file
    of: output file
    bs: 规划一个block的大小, 默认是512Bytes
    count:多少各bs的意思  
  ```
