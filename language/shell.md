# shell
命令解释器，将外层应用解释为机械码  
也是一个编程语言，可以直接调用linux系统命令

<!-- vim-markdown-toc Marked -->

* [shell语言的分类](#shell语言的分类)
    * [查看系统支持的shell语言](#查看系统支持的shell语言)
* [shell脚本的执行方法](#shell脚本的执行方法)
    * [echo输出命令](#echo输出命令)
    * [第一个脚本](#第一个脚本)
    * [执行脚本](#执行脚本)
* [Bash的基本功能](#bash的基本功能)
    * [历史命令和补全](#历史命令和补全)
        * [history](#history)
        * [历史命令的调用](#历史命令的调用)
    * [命令别名和常用快捷键](#命令别名和常用快捷键)
        * [alias](#alias)
        * [命令执行循序](#命令执行循序)
        * [常用快捷键](#常用快捷键)
    * [输入输出重定向](#输入输出重定向)
        * [标准输入输出](#标准输入输出)
        * [输出重定向](#输出重定向)
        * [输入重定向](#输入重定向)
    * [多命令顺序执行与管道符](#多命令顺序执行与管道符)
        * [多命令执行符](#多命令执行符)
        * [管道符](#管道符)
    * [通配符和特殊符号](#通配符和特殊符号)
        * [通配符](#通配符)
        * [其他特殊符号](#其他特殊符号)
* [Bash的变量](#bash的变量)
    * [变量分类](#变量分类)
    * [用户自定义变量](#用户自定义变量)
        * [命名规则](#命名规则)
        * [本地变量](#本地变量)
    * [环境变量](#环境变量)
        * [环境变量是什么](#环境变量是什么)
        * [设置环境变量](#设置环境变量)
        * [常见的环境变量](#常见的环境变量)
    * [位置参数变量](#位置参数变量)
    * [预定义变量](#预定义变量)
        * [接收键盘输入](#接收键盘输入)
* [Bash的运算符](#bash的运算符)
    * [数值运算和运算符](#数值运算和运算符)
        * [declare声明变量类型](#declare声明变量类型)
        * [进行数值运算的方法](#进行数值运算的方法)
        * [运算符](#运算符)
    * [变量测试与内容变换](#变量测试与内容变换)
* [环境变量配置文件](#环境变量配置文件)
    * [环境变量文件简介](#环境变量文件简介)
        * [系统中的环境变量配置文件](#系统中的环境变量配置文件)
    * [环境变量定义文件作用](#环境变量定义文件作用)
    * [其他配置文件和登录信息](#其他配置文件和登录信息)
        * [注销时候生效的环境变量配置文件](#注销时候生效的环境变量配置文件)
        * [其他配置文件](#其他配置文件)
        * [shell登录信息](#shell登录信息)
* [基础正则表达式](#基础正则表达式)
        * [正则表达式与通配符](#正则表达式与通配符)
        * [基础正则表达式](#基础正则表达式)
* [字符截取命令](#字符截取命令)
    * [cut字段提取命令](#cut字段提取命令)
    * [printf命令](#printf命令)
        * [print和printf区别](#print和printf区别)
    * [awk命令](#awk命令)
        * [条件](#条件)
        * [动作](#动作)
    * [sed](#sed)
* [字符处理命令](#字符处理命令)

<!-- vim-markdown-toc -->

## shell语言的分类
1. Bourne
- sh
- ksh  
- Bash(linux中用的,和sh兼容)
- psh
- zsh
2. C
- csh
- tcsh

### 查看系统支持的shell语言
```
cat /etc/shells
# /etc/shells: valid login shells
/bin/sh
/bin/bash
/usr/bin/bash
/bin/rbash
/usr/bin/rbash
/bin/dash
/usr/bin/dash
```
直接在交互框中输入shell的名字就可以切换shell 

## shell脚本的执行方法
### echo输出命令
```
echo [选项] [输出内容]
```
选项
- -e    支持反斜线控制的字符转化

|控制字符|作用|
|:---:|:----|
|\|输出\|
|\a|输出警告声|
|\b|退格键|
|\c|取消输出行末的换行符|
|\e|ESCAPE键|
|\f|换页键|
|\n|换行|
|\r|回车|
|\t|tab|
|\v|垂直制表符|
|\0nnn|按八进制ascll输出|
|\xhh|按16位ascll输出|

```
echo -e "\e[1;31m abcd \e[0m"   //\e[1;开启颜色输出,31m红色
```

### 第一个脚本
开头必须要由
```
#!/bin/Bash
```
以sh为后缀

### 执行脚本
1. 赋予权限,直接执行(dui)
```
chmod 755 hello.sh
./hello.sh
```
2. 通过Bash调用执行脚本
```
bash hello.sh
```
## Bash的基本功能
### 历史命令和补全
#### history
history [选项][历史命令保存文件]  
选项  
- -c 清空历史命令  
- -w 把缓存中的历史命令写入文件~/.bash_history

#### 历史命令的调用
- 上下箭头调用之前的历史命令
- !n重复调用第n调命令
- !! 重复调用上一条命令
- !字串 重复调用最后一条该字串开头的命令

### 命令别名和常用快捷键
#### alias
```
alias   //查询别名
alias 别名='原来命令'   //设置别名
unalias 别名    //删除别名
```
在/root/.bashrc中改变可以让别名永久生效
#### 命令执行循序
1. 绝对路径和相对路径执行的命令
2. 执行别名
3. Bash的内部命令
4. \$PATH环境变量定义的第一个命令

#### 常用快捷键
|快捷键|作用|
|:---:|:-----|
|ctrl+A|光标移动到命令行开头|
|ctrl+E|光标移动到命令行结尾|
|***ctrl+C***|强制终止当前命令|
|***ctrl+L***|清屏|
|***ctrl+U***|删除剪切光标之前的内容|
|ctrl+K|删除剪切光标之后的内容|
|***ctrl+Y***|粘贴|
|***ctrl+R***|在历史命令中搜索|
|***ctrl+D***|退出终端|
|ctrl+Z|暂停并放入后台|
|ctrl+S|暂停屏幕输出|
|ctrl+Q|回复屏幕输出|

### 输入输出重定向
#### 标准输入输出
|设备|设备文件名|文件描述符|类型|
|:---:|:---:|:---:|:---:|
|键盘|\/dev\/stdin|0|标准输入|
|显示器|\/dev\/sdtout|1|标准输出|
|显示器|\/dev\/sdterr|2|标准错误输出| 

#### 输出重定向
|类型|符号|作用|
|:----|:----|:----|
|标准输出重定向|命令 > 文件|覆盖,正确输出|
| |命令 >> 文件|追加,正确输出|
|标准错误输出重定向|错误命令 2> 文件|覆盖,错误输出|
| |错误命令 2>> 文件|追加,错误输出|
|正确输出和错误输出同时保存|命令 > 文件 2>&1|覆盖,错误正确同时|
| | 命令 >> 文件 2>&1|追加,错误正确同时|
| | 命令 &> 文件|覆盖,错误正确同时|
| | 命令 &>> 文件|追加,错误正确同时|
| | 命令 >> 文件1 2>>文件2|正确到文件1,错误到文件2|

#### 输入重定向
```
wc 选项 文件名  //统计文件中的***, 按<c-d>结束
```
选项
- -c 统计字节数
- -w 统计单词数
- -l 统计行数 
```
命令<文件   //对文件执行命令
```

### 多命令顺序执行与管道符
#### 多命令执行符
|多命令执行符|格式|作用|
|:----|:----|:----|
|;|命令1;命令2;...|无任何关系,并行执行几条命令|
|&&|命令1 && 命令2|命令1正确执行才会执行命令2|
|\|\||命令1 \|\| 命令2|命令1不正确执行才会执行命令2|

```
dd if=输入文件 of=输出文件 bs=字节数 count=个数
选项
if=输入文件 //指定源文件或原设备
of=输出文件 //指定目标文件或目标设备
bs=字节数   //指定一次传递多少字节,把这些字节看作是一个数据块
count=个数  //指定传入多少数据块

date ; dd if=/dev/zero of=testfile bs=1k count=100000 ; date   //测试磁盘速度

//执行结果
2021年 02月 24日 星期三 22:41:36 CST
记录了100000+0 的读入
记录了100000+0 的写出
102400000 bytes (102 MB, 98 MiB) copied, 1.42232 s, 72.0 MB/s
2021年 02月 24日 星期三 22:41:37 CST
```
```
./configure && make && make install //配置加编译加编译安装
命令 && echo yes || echo no //判断命令是否正确执行
```

#### 管道符
```
命令1 | 命令2   //命令1的正确输出作为命令2的操作对象
ll -a /etc/ | more  //分屏显示命令输出内容
netstat -an | grep "ESTABLISHED"    //查找当前正在登录服务器的对象
```
```
grep 选项 "搜索内容" 文件名 //将文件中关键字所在行提取出来
选项
-i  忽略大小写
-n  输出行号
-v  反向查找
--color=auto    //搜索出来的关键字用颜色显示
```
### 通配符和特殊符号
#### 通配符
|通配符|作用|
|:----|:----|
|?|匹配一个任意字符|
|*|匹配零个,一个或多个任意字符|
|[]|匹配中括号中任意一个字符|
|[-]|匹配中括号中任意一个字符,-表示范围|
|[^]|逻辑非|

#### 其他特殊符号
|符号|作用|
|:----|:----|
|''|单引号,在其内任何符号没有特殊含义|
|""|双引号,在其内有特殊含义|
|\`\`|反引号,括起来的内容会执行系统命令|
|\$()|表示括号内的内容是系统命令|
|#|该行注释|
|\$|用来调用变量的值|
|\\|转义符|

## Bash的变量
### 变量分类
- 用户自定义变量
- 环境变量:主要保存的是和系统操作环境相关的数据
- 位置参数变量:主要用来向脚本当中的传递参数或数据的,变量名不能自定义,变量作用固定
- 预定义变量:已经定义好的变量,变量名不能自定义,变量作用固定
### 用户自定义变量
#### 命名规则
- 可以由字母，数字，下划线组成
- 不能以字母开头
- Bash中变量的默认类型是字符串
- 变量用等号连接，不能有空格
- 变量的值如果有空格需要单引号或双引号
- 变量的值可以用\转义符
- 环境变量建议大写,便于区分
- 如果要把命令结果作为变量,需要用\`\`或\$()

#### 本地变量
```
name="Fan Chongru"  //变量定义

//变量叠加
aa=123
aa="$aa"456
aa=${aa}789

echo $name  //变量调用
set //变量查看
unset name  //变量删除
```

### 环境变量
#### 环境变量是什么
用户自定义变量只在当前shell中生效,环境变量可以在本shell和子shell生效,如果写入配置文件,环境变量对所有shell生效
#### 设置环境变量
```
export 变量名=变量值    //定义环境变量
pstree  //查看当前的行程
export 变量 //将本地变量转变为环境变量
env     //查询环境变量
unset 变量名    //删除变量
```

#### 常见的环境变量
- PATH  
    系统查找命令的路径  
PATH="\$PATH":/root/sh   //添加命令的路径,可以自定义命令
- PS1  
    定义系统提示符的变量
|特殊符号(默认前面都有\号|作用|
|:---|:---|
|d|显示日期|
|h|显示简写主机名|
|t|24小时时间|
|T|12小时时间|
|A|24小时时间省略秒|
|u|当前用户名|
|w|当前目录完整目录|
|W|当前目录最后一个目录|
|#|执行的第几个命令|
|\$|提示符|

### 位置参数变量
|位置参数变量|作用|
|:---|:---|
|\$n|n是数字,\$0表示命令本身,之后表示第n个参数,超过9可以用大括号括住|
|\$*|表示命令行中所有参数,把所有参数看作一个整体|
|\$@|表示命令行中的所有参数,但是把所有参数分开对待|
|\$#|表示命令行中参数的个数|

### 预定义变量
|预定义变量|作用|
|:---|:---|
|\$?|最后一次命令的返回状态,正确执行是0,不正确是非零|
|\$\$|当前进程的进程号(PID)|
|\$!|后台运行的最后一个进程的进程号|

#### 接收键盘输入
```
read [选项] [变量名]    //接收键盘输入传入变量名
选项
-p "提示信息"   //在等待输入时输出提示信息
-t 秒数 //等待一定时间,到时间自动中止
-n 字符数   //到一定字符数自动终止
-s  //隐藏输入数据
```

## Bash的运算符
### 数值运算和运算符
#### declare声明变量类型
```
declare [+/-][选项] 变量名  //声明变量
选项
-:  给变量设定类型属性
+:  取消变量的类型属性
-i  将变量声明为整形
-x  将变量声明为环境变量
-p  显示指定变量的被声明的类型
```

#### 进行数值运算的方法
1. declare声明法
```
declare -i cc=$aa+$bb
```
2. expr或let数值运算工具
```
dd=$(expr $aa + $bb)    //+左右两侧都有空格
```
3. \$运算符
```
ff=$(($aa+$bb))
gg=$[$aa+$bb]
```

#### 运算符 

### 变量测试与内容变换
太复杂，有机会查表知道就行
|变量置换方式|变量y没有设置|变量y为空值|变量y设置值|
|:---|:---|:---|:---|
|x=\${y-新值}|x=新值|x为空|x=\$y|
|x=\${y:-新值}|x=新值|x=新值|x=\$y|
|x=\${y+新值}|x为空|x=新值|x=新值|
|x=\${y:+新值}|x为空|x为空|x=新值|
|x=\${y=新值}|x=新值,y=新值|x为空,y不变|x=\$y,y不变|
|x=\${y:=新值}|x=新值,y=新值|x为空,y不变|x=\$y,y不变|
|x=\${y?新值}|新值输出到屏幕|x为空|x=\$y|
|x=\${y:?新值}|新值输出到屏幕|新值输出到屏幕|x=\$y|

## 环境变量配置文件
### 环境变量文件简介
```
source 配置文件 //强制让配置文件生效
. 配置文件  //同上
```
配置文件中主要是定义对系统操作环境生效的默认环境变量

#### 系统中的环境变量配置文件
- /etc/profile
- /etc/profile.d/*.sh
- ~/bash_profile
- ~/.bashrc
- /etc/bashrc

### 环境变量定义文件作用
***以下情况不适用与树莓派系统***
1. /etc/profile
```
//用户登录情况
定义USER变量    //当前用户名
定义LOGNAME变量 //登录用户名
定义MAIL变量    //当前登录邮箱
定义PATH变量    //系统命令查找
定义HOSTNAME变量    //主机名
定义HISTSIZE变量    //历史命令条数
定义umask变量   //默认权限值
调用/etc/profile.d/*.sh文件
```
2. /etc/profile.d/lang.sh  
调用语言的文件

3. ~/.bash_profile
调用下一个文件,~/.bashrc,增加家目录下PASH变量

4. ~/.bashrc
定义系统别名

5. /etc/bashrc
```
定义PS1
//用户没有登录shell时
定义umask变量
定义PATH变量
调用/etc/profile.d/*.sh
```

### 其他配置文件和登录信息
#### 注销时候生效的环境变量配置文件
- ~/.bash_logout  
默认是空的
#### 其他配置文件
- ~/.bash_history  
保存历史命令
#### shell登录信息
- 本地终端欢迎信息:/etc/issue  
    只对本地登录生效
|转义符|作用|
|:---|:---|
|\d|显示当前系统日期|
|\s|显示操作系统名称|
|\l|显示登录的终端号|
|\m|显示硬件体系结构|
|\n|显示主机名|
|\o|显示域名|
|\r|显示内核版本|
|\t|显示当前系统时间|
|\u|显示当前登录用户序列号|

- 远程终端欢迎信息:/etc/issue.net
    1. 不能使用转义符
    2. 是否显示由ssh配置文件/etc/ssh/sshd_config决定,加入"Banner /etc/issue.net"之后重启ssh生效

- 登陆后欢迎信息:/etc/motd  
    登录之后的欢迎信息,远程和ssh都可以

## 基础正则表达式
#### 正则表达式与通配符
- 正则表达式是在文件中搜索符合条件的字符串
- 通配符是用来匹配符合条件的文件名
- 正则表达式是包含匹配
- 通配符是完全匹配

#### 基础正则表达式
|元字符|作用|
|:---|:---|
|*|前一个字符匹配0次或多次|
|.|匹配除了换行符之外的任意字符|
|^|匹配行首|
|\$|匹配行尾|
|[]|匹配中括号中任意字符|
|[^]|取反|
|\\|转义符|
|\\{n\\}|表示前面的字符恰好出现n次|
|\\{n, \\}|前面的字符至少出现n次|
|\\{n, m\\}|前面的字符出现n-m次|

```
grep "a*" test.txt    #匹配任意字符
grep "aa*" test.txt    #匹配包含a的行
grep "aaa*" test.txt    #匹配最少包含两个连续的a的字符串

grep "s..d" test.txt    #匹配s和d之间有两个字符
grep "s.*d" test.txt    #匹配s和d之间有0到多个字符
grep ".*" test.txt    #匹配所有内容

grep "^M" test.txt    #匹配M开头的字符
grep "n$" test.txt    #匹配n结尾的字符
grep "^$" test.txt    #匹配空白行

grep "s[ao]id" test.txt    #匹配said或soid
grep "[0-9]" test.txt    #匹配任意一个数字
grep "^a-zA-Z" test.txt    #匹配任意不含字母的行

grep "^[0-9]\{3, \}[a-z]" test.txt    #匹配最少用连续用三个数字开头的行
grep "" test.txt    #匹配
grep "" test.txt    #匹配
grep "" test.txt    #匹配
```

## 字符截取命令
### cut字段提取命令
```
cut [选项] 文件名
选项:
-f 列号 //提取第几列
-d 分隔符   //按照指定分隔符分割列,默认分隔符是TAB
```
一般情况下和grep通过管道符一起使用

### printf命令
```
printf '输出类型输出格式' 输出内容
输出类型:
%ns:    输出字符串,n是数字,指代几个字符
%ni:    输出整数,n指代几个数字
%m, nf  输出浮点数,m位的浮点数,其中n位是小数

输出格式
\a: 输出警告声
\b: 输出退格键
\f: 清屏
\n: 换行
\r: 回车
\t: 水平制表符
\v: 垂直制表符

```

#### print和printf区别
- print会在后面自己加换行符
- print不能在系统中用,只能在awk编程中用

### awk命令
```
awk '条件1{动作1} 条件2{动作2}...' 文件夹
条件:
一般使用关系表达式作为条件
```
例子
```
df -h | awk '{print $1 "\t" $5 "\t" $6}'
得到
文件系统	已用%	挂载点
/dev/root	10%	/
devtmpfs	0%	/dev
tmpfs	0%	/dev/shm
tmpfs	2%	/run
tmpfs	1%	/run/lock
tmpfs	0%	/sys/fs/cgroup
/dev/mmcblk0p1	19%	/boot
tmpfs	1%	/run/user/1000
```

#### 条件
- BEGIN  
    BEGIN是awk的一个条件,指的是会在调用数据之前先执行一次BEGIN后面的条件
- END  
    在所有数据处理完之后执行

#### 动作
- FS内置变量  
    默认分隔符是空格或制表符, 通过改变FS可以指定分隔符

### sed
主要用来将数据选取, 替换, 删除, 新增的命令  
支持管道符操作,可以直接通过管道符的文本进行操作
```
sed 选项 '动作' 文件名
选项:
-n  只把经过处理的数据的行输出到屏幕
-e  允许对输入数据应用多条seg编辑
-i  用sed的修改结果直接修改文件,而不是屏幕输出
动作:
a \ 追加,在当前行后添加一行,要添加若干行需要在后面加上\
c \ 行替换,c后面的字符串 替换原数据行, 替换多行时后面加\
i \ 插入,在当前行插入一行或多行,多行后面加上\
d   删除指定行
p   打印指定行
s   s/旧字串/新字串/g 替换指定字符串
```
例子
```
sed '2i hello\
world' student.txt  //在第二行插入两行数据
```

## 字符处理命令
-   sort
```
sort [选项] 文件名
选项:
-f  忽略大小写
-n  以数值型进行排序,默认是字符串型排序
-r  反向排序
-t  指定分隔符,默认分隔符是制表符
-k n[,m]    按照指定的字段范围排序,从第n字段开始,m字段结束(默认到行尾)
```
-   wc
统计命令
```
wc [选项] 文件名
选项:
-l  只统计行
-w  只统计单词数
-w  只统计字符数
```

